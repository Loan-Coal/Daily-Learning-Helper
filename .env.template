# =============================================================================
# DANTA AGENTIC TEACHING - ENVIRONMENT CONFIGURATION TEMPLATE
# =============================================================================
# Copy this to .env and fill in your actual API keys and configuration values
#
# This project consists of multiple services:
# 1. Client (React frontend) - Port 5173 (dev)
# 2. Server (Node.js backend) - Port 3001
# 3. MCP Server (AI/Vector service) - Port 3002
#
# Setup Instructions:
# 1. Copy this file to each service directory and rename to .env
# 2. Replace all "your_*_here" values with your actual credentials
# 3. Run database migrations: cd server && npx prisma db push
# 4. Install dependencies: npm install (in each directory)
# 5. Start services: npm run dev (in server, mcp-server, and client)
# =============================================================================

# -----------------------------------------------------------------------------
# CLIENT (.env)
# Copy this section to client/.env
# -----------------------------------------------------------------------------

# Development server configuration
VITE_API_BASE_URL=http://localhost:3001
VITE_MCP_SERVER_URL=http://localhost:3002
VITE_ENV=development

# Optional: Analytics and monitoring
VITE_SENTRY_DSN=your_sentry_dsn_here
VITE_GOOGLE_ANALYTICS=your_ga_id_here

# -----------------------------------------------------------------------------
# MAIN BACKEND SERVER (.env)
# Copy this section to server/.env
# -----------------------------------------------------------------------------

# Server Configuration
PORT=3001
NODE_ENV=development
DATABASE_URL="file:./prisma/dev.db"

# Authentication
JWT_SECRET=your_super_secret_jwt_key_change_this_in_production_12345

# MCP Server Integration
MCP_SERVER_URL=http://localhost:3002
MCP_SERVER_ENABLED=true

# AI Configuration (for health checks and fallback detection)
MIXTRAL_API_KEY=your_mixtral_api_key_here
HUGGINGFACE_API_KEY=your_huggingface_api_key_here

# File Upload Configuration
MAX_FILE_SIZE=50MB
ALLOWED_FILE_TYPES=pdf,docx,txt
UPLOAD_DIR=uploads

# Email Configuration (optional)
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=your_email@gmail.com
SMTP_PASS=your_app_password_here

# Logging
LOG_LEVEL=info
LOG_FILE=./logs/server.log

# -----------------------------------------------------------------------------
# MCP SERVER (.env)
# Copy this section to mcp-server/.env
# -----------------------------------------------------------------------------

# Server Configuration
NODE_ENV=development
PORT=3002

# Mixtral AI Configuration (REQUIRED for AI question generation)
# Get your API key from: https://console.mistral.ai/
MIXTRAL_API_KEY=your_mixtral_api_key_here
MIXTRAL_API_URL=https://api.mistral.ai/v1
MIXTRAL_MODEL=mistral-large-latest

# HuggingFace Configuration (REQUIRED for embeddings)
# Get your API key from: https://huggingface.co/settings/tokens
HUGGINGFACE_API_KEY=your_huggingface_api_key_here
EMBEDDING_MODEL=sentence-transformers/all-MiniLM-L6-v2

# Chroma Vector Database Configuration
CHROMA_COLLECTION_NAME=danta_documents
CHROMA_PERSIST_DIRECTORY=./chroma_data

# Document Processing Configuration
CHUNK_SIZE=1500
CHUNK_OVERLAP=200
MAX_CHUNKS_PER_QUERY=20
MAX_DOCUMENT_SIZE=100MB

# Authentication (must match main server)
JWT_SECRET=your_super_secret_jwt_key_change_this_in_production_12345

# Main Backend Communication
MAIN_BACKEND_URL=http://localhost:3001

# Database (shared with main backend)
DATABASE_URL=file:../server/prisma/dev.db

# Logging Configuration
LOG_LEVEL=info
LOG_FILE=./logs/mcp-server.log

# Performance Tuning
GENERATION_TIMEOUT=120000
EMBEDDING_BATCH_SIZE=10
VECTOR_SEARCH_LIMIT=50

# =============================================================================
# GETTING YOUR API KEYS
# =============================================================================

# MIXTRAL API KEY:
# 1. Go to https://console.mistral.ai/
# 2. Create an account or sign in
# 3. Navigate to API Keys section
# 4. Create a new API key
# 5. Copy the key and replace "your_mixtral_api_key_here" above

# HUGGINGFACE API KEY:
# 1. Go to https://huggingface.co/
# 2. Create an account or sign in
# 3. Go to Settings â†’ Access Tokens
# 4. Create a new token with "Read" permissions
# 5. Copy the token and replace "your_huggingface_api_key_here" above

# JWT SECRET:
# Generate a secure random string for JWT_SECRET
# Example: openssl rand -base64 32
# Use the same value in both server and mcp-server .env files

# =============================================================================
# TESTING YOUR SETUP
# =============================================================================

# 1. Health Check Endpoints:
#    - Main Server: http://localhost:3001/health
#    - MCP Server: http://localhost:3002/health

# 2. Test Mixtral Connection:
#    - GET http://localhost:3002/api/questions/test-mixtral

# 3. Test File Upload:
#    - Upload a PDF through the web interface
#    - Check processing status in logs

# 4. Test Question Generation:
#    - Select tags and start a quiz
#    - Monitor the generation process

# =============================================================================
# PRODUCTION DEPLOYMENT NOTES
# =============================================================================

# For production deployment:
# 1. Change NODE_ENV to "production" in all services
# 2. Use environment-specific database URLs
# 3. Generate secure JWT secrets
# 4. Configure proper logging and monitoring
# 5. Set up SSL/HTTPS termination
# 6. Configure CORS origins appropriately
# 7. Use process managers like PM2 for Node.js services
# 8. Set up database backups
# 9. Configure rate limiting and security headers
# 10. Monitor API usage and costs

# =============================================================================
# TROUBLESHOOTING
# =============================================================================

# Common Issues:

# Issue: "Failed to connect to MCP server"
# Solution: Ensure MCP_SERVER_URL is correct and MCP server is running

# Issue: "Mixtral API calls failing"
# Solution: Check MIXTRAL_API_KEY is valid and you have API credits

# Issue: "Embedding generation fails"
# Solution: Verify HUGGINGFACE_API_KEY has correct permissions

# Issue: "Database connection errors"
# Solution: Run `npx prisma db push` to create/update database schema

# Issue: "JWT token validation fails"
# Solution: Ensure JWT_SECRET matches between server and mcp-server

# For more help, check the logs:
# - Server logs: server/logs/
# - MCP Server logs: mcp-server/logs/
# - Browser console for client-side errors